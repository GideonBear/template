name: pre-commit autofix

on:
  pull_request:

permissions: {}

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

jobs:
  main:
    name: pre-commit autofix
    runs-on: ubuntu-latest

    permissions:
      contents: write # (read) actions/checkout, (write) stefanzweifel/git-auto-commit-action

    steps:
      - uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2
        with:
          # If not specified, actions/checkout checks out in detached HEAD state,
          #  while git-auto-commit-action needs a branch to push to
          ref: ${{ github.head_ref }}
          persist-credentials: true # zizmor: ignore[artipacked] # necessary for stefanzweifel/git-auto-commit-action

      - uses: actions/setup-python@a309ff8b426b58ec0e2a45f0f869d46889d02405 # v6.2.0
        with:
          python-version: 3.x

      # From https://github.com/pre-commit/action/blob/main/action.yml

      - run: pip install pre-commit

      - uses: actions/cache@cdf6c1fa76f9f475f3d7449005a359c84ca0f306 # v5.0.3
        with:
          path: ~/.cache/pre-commit
          key: pre-commit-3|${{ env.pythonLocation }}|${{ hashFiles('.pre-commit-config.yaml') }}

      - run: pre-commit run --show-diff-on-failure --color=always --all-files

      - uses: stefanzweifel/git-auto-commit-action@04702edda442b2e678b25b537cec683a1493fcb9 # v7.1.0
        if: always()
        with:
          commit_message: pre-commit autofixes
